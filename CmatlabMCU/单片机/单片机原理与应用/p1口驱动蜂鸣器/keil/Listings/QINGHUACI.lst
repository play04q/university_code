C51 COMPILER V9.54   QINGHUACI                                                             04/12/2023 14:30:29 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE QINGHUACI
OBJECT MODULE PLACED IN .\Objects\QINGHUACI.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE QINGHUACI.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\QINGHUACI.lst) TABS(2) OBJECT(.\Objects\QINGHUACI.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          sbit speaker = P0^7;
   4          unsigned char timer0h, timer0l, time;
   5          //--------------------------------------
   6          //单片机晶振采用11.0592MHz
   7          // 频率-半周期数据表 高八位 本软件共保存了四个八度的28个频率数据
   8          code unsigned char FREQH[] = {
   9          0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8, //低音1234567
  10          0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC,//1,2,3,4,5,6,7,i
  11          0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE, //高音 234567
  12          0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF}; //超高音 1234567
  13          // 频率-半周期数据表 低八位
  14          code unsigned char FREQL[] = {
  15          0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6, //低音1234567
  16          0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, //1,2,3,4,5,6,7,i
  17          0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D, //高音 234567
  18          0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16}; //超高音 1234567
  19          //--------------------------------------
  20          code unsigned char sszymmh[] = {5,2,1, 5,2,1, 3,2,1, 2,2,1, 3,2,1, 6,1,2, 2,2,1, 3,2,1, 5,2,1, 3,2,1, 2,2,
             -2,
  21          0,0,2, 5,2,1, 5,2,1, 3,2,1, 2,2,1, 3,2,1, 5,1,2, 2,2,1, 3,2,1, 5,2,1, 3,2,1, 1,2,2,
  22          0,0,2, 1,2,1, 2,2,1, 3,2,1, 5,2,1, 6,2,1, 5,2,1, 3,2,1, 5,2,1, 3,2,1, 3,2,1, 2,2,1, 2,2,2,
  23          0,0,2, 1,2,1, 2,2,1, 1,2,1, 2,2,1, 1,2,1, 2,1,1, 3,2,1, 5,2,1, 3,2,3,};
  24          //结束标记
  25          //世上只有妈妈好数据表 要想演奏不同的乐曲, 只需要修改这个数据表
  26          //code unsigned char sszymmh[] = {
  27          //6, 2, 3, 5, 2, 1, 3, 2, 2, 5, 2, 2, 1, 3, 2, 6, 2, 1, 5, 2, 1,
  28          //一个音符有三个数字。前为第几个音、中为第几个八度、后为时长（以半拍为
             -位）。
  29          //6, 2, 3代表：6, 中音, 3个半拍;
  30          //5, 2, 1代表：5, 中音, 1个半拍;
  31          //3, 2, 2代表：3, 中音, 2个半拍;
  32          //5, 2, 2代表：5, 中音, 2个半拍;
  33          //1, 3, 2代表：1, 高音, 2个半拍;
  34          //
  35          //6, 2, 4, 3, 2, 2, 5, 2, 1, 6, 2, 1, 5, 2, 2, 3, 2, 2, 1, 2, 1,
  36          //6, 1, 1, 5, 2, 1, 3, 2, 1, 2, 2, 4, 2, 2, 3, 3, 2, 1, 5, 2, 2,
  37          //5, 2, 1, 6, 2, 1, 3, 2, 2, 2, 2, 2, 1, 2, 4, 5, 2, 3, 3, 2, 1,
  38          //2, 2, 1, 1, 2, 1, 6, 1, 1, 1, 2, 1, 5, 1, 6, 0, 0, 0,,,,,,,,,,,,,,,,,,,,,6,2,3, 6,2,1, 1,3,2, 7,2,1, 6,2
             -,1, 5,2,2, 3,2,1, 5,2,1, 6,2,4, 3,2,3,};
  39          //--------------------------------------
  40          void t0int() interrupt 1 //T0中断程序，控制发音的音调
  41          {
  42   1      TR0 = 0; //先关闭T0
  43   1      speaker = !speaker; //输出方波, 发音
  44   1      TH0 = timer0h; //下次的中断时间, 这个时间, 控制音调高低
  45   1      TL0 = timer0l;
  46   1      TR0 = 1; //启动T0
  47   1      }
  48          //--------------------------------------
  49          void delay(unsigned char t) //延时程序，控制发音的时间长度
  50          {
  51   1      unsigned char t1;
C51 COMPILER V9.54   QINGHUACI                                                             04/12/2023 14:30:29 PAGE 2   

  52   1      unsigned long t2;
  53   1      for(t1 = 0; t1 < t; t1++) //双重循环, 共延时t个半拍
  54   1      for(t2 = 0; t2 < 8000; t2++); //延时期间, 可进入T0中断去发音
  55   1      TR0 = 0; //关闭T0, 停止发音
  56   1      }
  57          //--------------------------------------
  58          void song() //演奏一个音符
  59          {
  60   1      TH0 = timer0h; //控制音调
  61   1      TL0 = timer0l;
  62   1      TR0 = 1; //启动T0, 由T0输出方波去发音
  63   1      delay(time); //控制时间长度
  64   1      }
  65          //--------------------------------------
  66          void main(void)
  67          {
  68   1      unsigned char k, i;
  69   1      TMOD = 1; //置T0定时工作方式1
  70   1      ET0 = 1; //开T0中断
  71   1      EA = 1; //开CPU中断
  72   1      while(1) {
  73   2      i = 0;
  74   2      time = 1;
  75   2      while(time) {
  76   3      k = sszymmh[i] + 7 * sszymmh[i + 1] - 1;
  77   3      //第i个是音符, 第i+1个是第几个八度
  78   3      timer0h = FREQH[k]; //从数据表中读出频率数值
  79   3      timer0l = FREQL[k]; //实际上, 是定时的时间长度
  80   3      time = sszymmh[i + 2]; //读出时间长度数值
  81   3      i += 3;
  82   3      song(); //发出一个音符
  83   3      }
  84   2      }
  85   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =    194    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
