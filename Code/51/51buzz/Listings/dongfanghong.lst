C51 COMPILER V9.54   DONGFANGHONG                                                          03/22/2023 20:39:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DONGFANGHONG
OBJECT MODULE PLACED IN .\Objects\dongfanghong.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE dongfanghong.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\dongfanghong.lst) TABS(2) OBJECT(.\Objects\dongfanghong.obj)

line level    source

   1          #include <reg52.h>
   2          sbit beep = P2^5;
   3          unsigned char timer0H, timer0L, time;
   4          
   5          //单片机晶振采用11.0592MHz
   6          // 高八度     
   7          code unsigned char FREQH[] = {
   8              0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8,    //低音
   9              0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC,//标准
  10              0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE,            //高音 
  11              0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF};   //超高音 
  12          // 低八度
  13          code unsigned char FREQL[] = {
  14              0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6,    //低音
  15              0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, //标准
  16              0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D,             //高音
  17              0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16};   //超高音
  18          code unsigned char song[] = {
  19          5,2,2,  5,2,1,  6,2,1,  2,2,4,  1,2,2,  1,2,1,  6,1,1,  2,2,4,
  20          5,2,2,  5,2,2,  6,2,1,  1,3,1,  6,2,1,  5,2,1,  1,2,2,  1,2,1,  6,1,1, 2,2,4,
  21          5,2,2,  2,2,2,  1,2,1,  7,1,1,  6,1,1,  5,1,2,  5,2,2,  2,2,2,
  22          3,2,1,  2,2,1,  1,2,2,  1,2,1,  6,1,1,
  23          2,2,1,  3,2,1,  2,2,1,  1,2,1,  2,2,1,  1,2,1,  7,1,1,  6,1,1,  5,1,4,  5,1,4,
  24          0,0,0,
  25          };
  26          
  27          void t0int() interrupt 1         //T0中断程序，控制发音的音调
  28          {
  29   1          TR0 = 0;                     //先关闭T0
  30   1          beep = !beep;          //输出方波, 发音
  31   1          TH0 = timer0H;               //下次的中断时间, 这个时间, 控制音调高低
  32   1          TL0 = timer0L;
  33   1          TR0 = 1;                     //启动T0
  34   1      }
  35          
  36          void delay(unsigned char t)     //延时程序，控制发音的时间长度
  37          {
  38   1          unsigned char t1;
  39   1          unsigned long t2;
  40   1          for(t1 = 0; t1 < t; t1++)    //双重循环, 共延时t个半拍
  41   1            for(t2 = 0; t2 < 10000; t2++); //延时期间, 可进入T0中断去发音
  42   1          TR0 = 0;                        //关闭T0, 停止发音
  43   1      }
  44          
  45          void sing()                      //演奏一个音符
  46          {
  47   1          TH0 = timer0H;               //控制音调
  48   1          TL0 = timer0L;
  49   1          TR0 = 1;                     //启动T0, 由T0输出方波去发音
  50   1          delay(time);                 //控制时间长度
  51   1      }
  52          
  53          void main(void)
  54          {
C51 COMPILER V9.54   DONGFANGHONG                                                          03/22/2023 20:39:26 PAGE 2   

  55   1          unsigned char k, i;
  56   1          TMOD = 1;                    //置T0定时工作方式1
  57   1          ET0 = 1;                     //开T0中断
  58   1          EA = 1;                      //开总中断
  59   1          while(1) 
  60   1        {
  61   2            i = 0;
  62   2            time = 1; 
  63   2            while(time) 
  64   2          {
  65   3              k = song[i] + 7 * song[i + 1] - 1;//第i个是音符, 第i+1个是第几个八度
  66   3              timer0H = FREQH[k];      //从数据表中读出频率数值
  67   3              timer0L = FREQL[k];      //时间长度
  68   3              time = song[i + 2];   //读出时间长度数值
  69   3              i += 3;
  70   3              sing();                  //发出一个音符
  71   3          }  
  72   2          }  
  73   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =    182    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
